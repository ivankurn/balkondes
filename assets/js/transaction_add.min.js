function updateSummary(e){var t=$("#package_type_select option:selected").attr("price"),a=a=$('div[data-repeater-list="group-a"] div.mt-repeater-item').length;"add"==e?a=$('div[data-repeater-list="group-a"] div.mt-repeater-item').length:"subtract"==e&&(a=$('div[data-repeater-list="group-a"] div.mt-repeater-item').length-1),$("#price_summary").text(t+"00"),$("#price_summary").priceFormat({prefix:"Rp ",centsSeparator:",",thousandsSeparator:"."}),$("#total_person_summary").text(a+" orang"),$("#total_price_summary").text(t*a+"00"),$("#total_price_summary").priceFormat({prefix:"Rp ",centsSeparator:",",thousandsSeparator:"."})}function resetForm(){$("form#form_package_select")[0].reset(),$("form#form_package_type_select")[0].reset(),$("form#form_tourist")[0].reset(),$("#package_type_select").hide(),$("#form_tourist").hide(),$("#summary").hide(),$("#submit_btn").hide(),$("#cancel_btn").hide(),$("div.invoice").hide(),$("#print_btn").hide()}function showInvoice(){$("#form").hide(),$("#summary").hide(),$("div.invoice").show(),$("#print_btn").show()}function submitGeneralForm(e,t){$.post(APP_URL+"/transaction/ajax/add/general",{_token:e,package_id:$("#package_type_select option:selected").val(),tourists:JSON.stringify(t)},function(e,t){App.stopPageLoading(),$(".alert.alert-success").remove(),$(".alert.alert-danger").remove();var a=JSON.parse(e);if("success"==a.status){var s=['<div class="alert alert-success hidden-print">','<button class="close" data-close="alert"></button>',"<span>",a.messages,"</span>","</div>"].join("");$(s).insertBefore("div.portlet.light.bordered:eq(0)"),App.scrollTo($("div.alert.alert-success")),resetForm(),$("#invoice_id").html(["#",a.data.transaction_id,"<br><br>",a.data.date,"<br>",a.data.time].join("")),$("#transaction_no").text(a.data.transaction_id),$("#package_name").text(a.data.package_name),$("#price").text(a.data.price+"00"),$("#price").priceFormat({prefix:"Rp ",centsSeparator:",",thousandsSeparator:"."}),$("#tourist_count").text(a.data.tourist_count+" orang"),$("#grand_total").text(a.data.grand_total+"00"),$("#grand_total").priceFormat({prefix:"Rp ",centsSeparator:",",thousandsSeparator:"."}),$("#grand_total_2").text(a.data.grand_total+"00"),$("#grand_total_2").priceFormat({prefix:"Rp ",centsSeparator:",",thousandsSeparator:"."}),showInvoice(),$.each(a.data.tickets,function(e,t){s=['<div class="page-break"></div>','<div class="ticket bordered">','<div class="row ticket-logo">','<div class="col-xs-6 ticket-logo">','<p class="left">',"Wisata Balkondes","</p>","</div>",'<div class="col-xs-6 ticket-logo">','<p class="right">',"Tiket","</p>","</div>","</div>",'<div class="row ticket-detail">','<div class="col-xs-12">','<span class="bold">Kode Tiket : #',t.barcode,"</span>","</div>",'<div class="col-xs-6 text-center">','<div class="something-semantic">','<div class="something-else-semantic">','<img src="/abt/barcode/',t.barcode,'.png" width="300px;" />',"</div>","</div>","</div>",'<div class="col-xs-1 text-center">','<div class="something-semantic">','<div class="something-else-semantic">','<img src="/abi/line_6.png" />',"</div>","</div>","</div>",'<div class="col-xs-5 text-center">','<div class="something-semantic">','<div class="something-else-semantic">','<img src="/abt/qrcode/',t.barcode,'.png" width="200px;" />',"</div>","</div>","</div>","</div>",'<div class="row ticket-tourist">','<div class="col-xs-12">','<font class="bold uppercase" style="color: #D3A64E !important;">Penumpang</font>',"</div>",'<div class="col-xs-3">',"<p>","Nama<br><br>",a.data.tourists[e].name,"</p>","</div>",'<div class="col-xs-1">','<img src="/abi/line_7.png" height="115px" />',"</div>",'<div class="col-xs-3">',"<p>","Nomor Telepon<br><br>",a.data.tourists[e].mobilephone,"</p>","</div>  ",'<div class="col-xs-1">','<img src="/abi/line_7.png" height="115px" />',"</div>",'<div class="col-xs-3">',"<p>","Email<br><br>",a.data.tourists[e].email,"</p>","</div>","</div>",'<div class="row ticket-driver">','<div class="col-xs-12">','<font class="bold uppercase" style="color: #D3A64E !important;">Driver</font>',"</div>",'<div class="col-xs-12 table-responsive table-head">','<table class="table table-hover">',"<thead>","<tr>",'<th class="invoice-title text-center">','<span class="bold uppercase">',"Trip","</span>","<br>","(Balkondes)","</th>",'<th class="invoice-title text-center">','<span class="bold uppercase">',"Driver","</span>","</th>",'<th class="invoice-title text-center">','<span class="bold uppercase">',"Vehicle","</span>","</th>",'<th class="invoice-title text-center">','<span class="bold uppercase">',"Jam","</span>","</th>","</tr>","</thead>","<tbody>"].join(""),$.each(a.data.routes,function(e,t){s+=["<tr>",'<td align="center">',t.balkondes_from_name," - ",t.balkondes_to_name,"</td>",'<td align="center">',"</td>",'<td align="center">',t.vehicle_type,"</td>",'<td align="center">',"</td>","</tr>"].join("")}),s+=["</tbody>","</table>","</div>","</div>","</div>"].join(""),$("div.page-content").append(s)})}else{if(null!=e.messages){showAlertPopUp("Error",e.messages);var s='<div class="alert alert-danger"><button class="close" data-close="alert"></button><span>'+e.messages+"</span></div>"}else{showAlertPopUp("Error",e.error);var s='<div class="alert alert-danger"><button class="close" data-close="alert"></button><span>'+e.error+"</span></div>"}$(".alert.alert-danger").remove(),$(s).insertBefore("#submit_form")}},"json")}function submitCustomForm(e,t){alert("custom form")}function submitForm(e){if(""!=e){var t=[],a=0;$('div[data-repeater-list="group-a"] div.mt-repeater-item').each(function(){t[a]={},t[a].name=$(this).find('input[name*="name-input"]').val(),t[a].email=$(this).find('input[name*="email-input"]').val(),t[a].mobilephone=$(this).find('input[name*="mobilephone-input"]').val(),a++}),"general"==$("#package_select option:selected").val()?submitGeneralForm(e,t):"custom"==$("#package_select option:selected").val()&&submitCustomForm(e,t)}}function checkInput(){alert("gagal")}var FormValidation=function(){var e=function(){var e=$("#form_tourist"),t=$(".alert-danger",e),a=$(".alert-success",e);e.validate({errorElement:"span",errorClass:"help-block help-block-error",focusInvalid:!1,ignore:"",messages:{},rules:{},invalidHandler:function(e,s){a.hide(),t.show(),App.scrollTo(t,-200)},errorPlacement:function(e,t){var a=$(t).parent(".input-group");a.size()>0?a.after(e):t.after(e)},highlight:function(e){$(e).closest(".validate-group").addClass("has-error")},unhighlight:function(e){$(e).closest(".validate-group").removeClass("has-error")},success:function(e){e.closest(".validate-group").removeClass("has-error")},submitHandler:function(e){a.show(),t.hide()}})};return{init:function(){e()}}}();$(function(){$("#package_type_select").hide(),$("#form_tourist").hide(),$("#summary").hide(),$("#submit_btn").hide(),$("#cancel_btn").hide(),$("div.invoice").hide(),$("#print_btn").hide(),FormValidation.init(),$("#package_select").on("change",function(){"general"==this.value?$("#package_type_select").show():$("#package_type_select").hide()}),$("#package_type_select").on("change",function(){""!=this.value?$("#form_tourist").show():$("#form_tourist").hide(),updateSummary()}),$('input[name="group-a[0][name-input]"]').on("input",function(){""==this.value||$("#summary").is(":visible")?""==this.value&&$("#summary").is(":visible")&&($("#summary").hide(),$("#submit_btn").hide()):($("#summary").show(),$("#submit_btn").show())}),$("#submit_btn").click(function(){if($("div.alert.alert-danger.display-hide").remove(),""==$("#package_select").val())$("div.alert.alert-danger.display-hide").remove(),$("div.form-body").prepend('<div class="alert alert-danger display-hide" style="display: block;"><button class="close" data-close="alert"></button>You have some form errors. Please check below.</div>'),App.scrollTo($("div.alert.alert-danger.display-hide"));else{var e=!0;$.when($('input[name*="name-input"]').each(function(t){""==$(this).val()&&($("div.alert.alert-danger.display-hide").remove(),$("div.form-body").prepend('<div class="alert alert-danger display-hide" style="display: block;"><button class="close" data-close="alert"></button>You have some form errors. Please check below.</div>'),$(this).parent().addClass("has-error"),$(this).parent().append('<span class="help-block help-block-error">This field is required.</span>'),App.scrollTo($("div.alert.alert-danger.display-hide")),e=!1)})).done(function(){e&&(App.startPageLoading({animate:!0}),getCSRFToken(submitForm))})}})});